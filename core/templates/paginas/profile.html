{% extends "base.html" %}
{% load static %}

{% block content %}
<style>
  .custom-orange-border:focus {
    border-color: #ff8c00;
    box-shadow: 0 0 0 0.25rem rgba(255, 140, 0, 0.25);
  }

  .profile-pic {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 50%;
    border: 3px solid #ff8c00;
  }

  .nav-link.active-orange {
    color: #fff !important;
    background-color: #ff8c00 !important;
    border-color: #ff8c00 !important;
  }
</style>

<main class="py-5">
  <div class="container">
    <div class="row">
      <div class="col-md-3">
        <div class="card shadow-sm mb-4">
          <div class="card-body text-center">
            <img src="{{ user.profile.image.url }}" class="profile-pic mb-3" alt="Foto de perfil">
            <h5 class="card-title">{{ user.first_name }} {{ user.last_name }}</h5>
            <p class="text-muted">{{ user.email }}</p>
          </div>
        </div>
        
        <div class="list-group">
          <a href="#" class="list-group-item list-group-item-action active-orange" aria-current="true">
            <i class="bi bi-person-fill me-2"></i> Mi Perfil
          </a>
          <a href="#" class="list-group-item list-group-item-action">
            <i class="bi bi-bag-check-fill me-2"></i> Mis Compras
          </a>
          <a href="#" class="list-group-item list-group-item-action">
            <i class="bi bi-geo-alt-fill me-2"></i> Direcciones Guardadas
          </a>
          <a href="#" class="list-group-item list-group-item-action">
            <i class="bi bi-lock-fill me-2"></i> Seguridad
          </a>
        </div>
      </div>
      
      <div class="col-md-9">
        <div class="card shadow-sm">
          <div class="card-body">
            <h2 class="card-title text-center mb-4" style="color: #ff8c00;">Actualizar Perfil</h2>
            <p class="lead text-center mb-4">
              Completa o actualiza tus datos y foto de perfil.
            </p>

            <form class="needs-validation" novalidate method="post" enctype="multipart/form-data">
              {% csrf_token %}
              
              <div class="text-center mb-4">
                <p class="fw-bold">Cambiar Foto de Perfil</p>
                <input type="file" class="form-control" id="profileImage" name="profileImage">
              </div>

              <hr class="my-4">

              <div class="row g-3">
                <div class="col-sm-6">
                  <label for="firstName" class="form-label">Nombre</label>
                  <input type="text" class="form-control custom-orange-border" id="firstName" name="firstName" value="{{ user.first_name }}" required>
                  <div class="invalid-feedback">
                    Se requiere un nombre válido.
                  </div>
                </div>

                <div class="col-sm-6">
                  <label for="lastName" class="form-label">Apellido</label>
                  <input type="text" class="form-control custom-orange-border" id="lastName" name="lastName" value="{{ user.last_name }}" required>
                  <div class="invalid-feedback">
                    Se requiere un apellido válido.
                  </div>
                </div>

                <div class="col-12">
                  <label for="email" class="form-label">Correo Electrónico</label>
                  <input type="email" class="form-control custom-orange-border" id="email" name="email" value="{{ user.email }}" required>
                  <div class="invalid-feedback">
                    Por favor, introduce un correo electrónico válido.
                  </div>
                </div>

                <div class="col-12">
                  <label for="address" class="form-label">Dirección</label>
                  <input type="text" class="form-control custom-orange-border" id="address" name="address" placeholder="123 Calle Principal" value="{{ user.profile.address }}" required>
                  <div class="invalid-feedback">
                    Por favor, introduce tu dirección.
                  </div>
                </div>

                <div class="col-12">
                  <label for="address2" class="form-label">Dirección 2 <span class="text-body-secondary">(Opcional)</span></label>
                  <input type="text" class="form-control custom-orange-border" id="address2" name="address2" placeholder="Apartamento o suite" value="{{ user.profile.address2 }}">
                </div>

                <div class="col-md-5">
                  <label for="country" class="form-label">País</label>
                  <select class="form-select custom-orange-border" id="country" name="country" required>
                    <option value="">Elegir...</option>
                    <option {% if user.profile.country == "Argentina" %}selected{% endif %}>Argentina</option>
                    <option {% if user.profile.country == "Brasil" %}selected{% endif %}>Brasil</option>
                    <option {% if user.profile.country == "Chile" %}selected{% endif %}>Chile</option>
                    <option {% if user.profile.country == "Colombia" %}selected{% endif %}>Colombia</option>
                    <option {% if user.profile.country == "España" %}selected{% endif %}>España</option>
                    <option {% if user.profile.country == "Estados Unidos" %}selected{% endif %}>Estados Unidos</option>
                    <option {% if user.profile.country == "México" %}selected{% endif %}>México</option>
                    <option {% if user.profile.country == "Perú" %}selected{% endif %}>Perú</option>
                  </select>
                  <div class="invalid-feedback">
                    Por favor, selecciona un país válido.
                  </div>
                </div>

                <div class="col-md-4">
                  <label for="state" class="form-label">Provincia/Estado</label>
                  <select class="form-select custom-orange-border" id="state" name="state" required>
                    <option value="">Elegir...</option>
                    <option {% if user.profile.state == "Buenos Aires" %}selected{% endif %}>Buenos Aires</option>
                    <option {% if user.profile.state == "California" %}selected{% endif %}>California</option>
                    <option {% if user.profile.state == "Madrid" %}selected{% endif %}>Madrid</option>
                  </select>
                  <div class="invalid-feedback">
                    Por favor, proporciona una provincia o estado válido.
                  </div>
                </div>

                <div class="col-md-3">
                  <label for="zip" class="form-label">Código Postal</label>
                  <input type="text" class="form-control custom-orange-border" id="zip" name="zip" placeholder="" value="{{ user.profile.zip }}" required>
                  <div class="invalid-feedback">
                    Se requiere un código postal.
                  </div>
                </div>
              </div>
              
              <hr class="my-4">

              <button class="w-100 btn btn-primary btn-lg" style="background-color: #ff8c00; border-color: #ff8c00;" type="submit">
                Guardar Cambios
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock content %}